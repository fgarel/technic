\documentclass{article}
% Les paramtres de connexion
\texdbconnection{postgres, localhost, fred, fred, exemples-lbd}

% Cration de la table notes , si elle existe dj , on ajoute # ou un
% autre symbole devant la premire ligne et on commente si ce n  est
% dj fait .
\texdbinstruction{
BEGIN;
COMMIT;
--BEGIN;
--DROP TABLE notes;
--  CREATE TABLE notes (
--    id integer primary key,
--    nom varchar(30),
--    dev1 numeric(3,1),
--    dev2 numeric(3,1),
--    dev3 numeric(3,1),
--    moy numeric(4,2),
--    rang integer);
--COMMIT;
-- % On remplit la table , calcule la moyenne et le rang .
BEGIN;
COMMIT;
--BEGIN;
--  COPY notes (id,nom,dev1,dev2,dev3)
--  FROM 'releve-notes' DELIMITERS !;
--  UPDATE notes SET moy = (dev1+dev2+dev3)/3;
--  UPDATE notes SET rang =
--     (SELECT count(w2.moy)+1 FROM notes w2 WHERE w2.moy>notes.moy);
--  COMMIT;
}

% Requte
\texdbdef{##q}{SELECT %
   nom,
   dev1,
   dev2,
   dev3,
   moy,
   rang
FROM notes ORDER by rang }

% Requte pour les moyennes de classe
\texdbdef{##m}{SELECT
  round(avg(dev1),1) as moydev1,
  round(avg(dev2),1) as moydev2,
  round(avg(dev3),1) as moydev3,
  round(avg(moy),1) as moyg
FROM notes }

\begin{document}
\begin{tabular}{|c|l|c|*{3}{c|}}
\hline
 Rang&Nom&moy&Dev1&Dev2&Dev3\\
\hline
% LES NOTES
\texdbfor{##q}{row.rang&row.nom&row.moy&row.dev1&row.dev2&row.dev3\\}
\hline
% LES MOYENNES
\texdbfor{##m}{&&row.moyg&row.moydev1&row.moydev2&row.moydev3\\}
\hline
\end{tabular}
\end{document}