%\documentclass[12pt,titlepage,oneside]{book}
\documentclass[12pt,titlepage]{book}

%\usepackage[latin1]{inputenc}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}

\usepackage[a3paper,landscape,vmargin=2cm,hmargin=1.5cm]{geometry}
\usepackage{multirow}
\usepackage{supertabular}
\usepackage{array}
\usepackage{lscape}
\usepackage{graphicx}

\usepackage{pslatex}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\author{Direction des Systèmes d'Information\\
Pôle Géomatique}
\title{Catalogue des objets topographiques}

% Les parametres de connexion
\begin{lbdpython}
# #################### #
# debut du code python #
# #################### #
# connexion à la base topographie
# -------------------------------
db = create_engine('postgres://fred@localhost/topographie')
metadata = BoundMetaData(db)


# definition des requetes : cf syntaxe SQLAlchemy
# -----------------------------------------------
# on definit les tables
theme_table = Table('theme', metadata, autoload=True)
domaine_table = Table('domaine', metadata, autoload=True)
classe_table = Table('classe', metadata, autoload=True)
objet_table = Table('objet', metadata, autoload=True)
initiale_table = Table('representation_initiale', metadata, autoload=True)
chagneau_table = Table('rep_chagneau', metadata, autoload=True)
objet_attribut_table = Table('objet_attribut_topo', metadata, autoload=True)


# on definit les alias
th = theme_table.alias('th')
dom = domaine_table.alias('dom')
cls = classe_table.alias('cls')
obj = objet_table.alias('obj')
ini = initiale_table.alias('ini')
cha = chagneau_table.alias('cha')
att = objet_attribut_table.alias('att')


# les requetes seront definies et executées au fur et à mesure

\end{lbdpython}

\begin{document}

%\begin{landscape}
\maketitle{}
%\end{landscape}


% dans le frontmatter, on met la préface et l'introduction generale
% dans le mainmatter, on met les differents chapitres
% dans le backmatter, on met la conclusion general et le sommaire
\frontmatter

% préface
% ^^^^^^^
\chapter{Préface}
Les services techniques de la ville de La Rochelle sont amenés à manipuler des plans à grande échelle.
Ils peuvent parfois aussi être amenés à gérer ces objets topographiques qui sont représentés sur ces plans.
En effet, certains de ces objets peuvent être sous la responsabilité de la ville de La Rochelle. 

\vspace{\baselineskip}
Le but de ce document est de recenser ces objets topographiques et de proposer une organisation informatique facilitant la gestion de ces objets.

\vspace{\baselineskip}
Dans ce document, on appelle objet topographique tout objet pouvant être réprésenté sur un plan à grande échelle.

% table des matières et table des figures
% ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
\tableofcontents


\listoffigures

% introdution generale
% ^^^^^^^^^^^^^^^^^^^^
\chapter{Introduction}
Les objets topographiques ont été classés.
Ce classement se décompose en Thèmes, Domaines et Classes.

Dans un premier temps, on présentera ce système de classement, puis, on listera ces différents objets en fonction de leur prise en charge actuel dans le SIG :
\begin{enumerate}
  \item l'objet n'est pas actuellement présent dans le SIG,
  \item l'objet est déjà pris en charge dans le SIG,
  \item liste de tous les objets, quelque soit son niveau de prise en charge.
\end{enumerate}

\mainmatter

\chapter{Système de classement}

% introdution de chapitre
% ^^^^^^^^^^^^^^^^^^^^^^^
\section{Introduction}
Ce système découle du classement actuel et essaye de l'enrichir selon une certaine logique.

% Les themes
% ^^^^^^^^^^
\section{Les Thèmes}
Le tableau ci-dessous liste les différents thèmes.
\vspace{\baselineskip}

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{2}{|c|}{Thème} \\
\hline
Identifiant & Thème\\
\hline
}
\tablehead{
\hline
\multicolumn{2}{|c|}{Thème} \\
\hline
Identifiant & Thème\\
\hline
}
\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|c|p{15cm}|}

\begin{lbdpython}
# execution d'une requete et parcours du resultat
# -----------------------------------------------
# -- selection theme
#SELECT
#   theme.theme_id as ThemeId,
#   theme.theme_libelle as ThemeLibelle,
#FROM theme
#ORDER by theme.theme_id;
req_theme_select = select([th.c.theme_id, th.c.theme_libelle],
                           order_by=[th.c.theme_id])
result = req_theme_select.execute()
for row in result:
  chaine = r"%s & %s \\" %(row.theme_id,row.theme_libelle)
  but.write(chaine)
  but.write(r"\hline")
  but.write("\n")

\end{lbdpython}
\end{supertabular}


% Les domaines
% ^^^^^^^^^^^^
\section{Les Domaines}
Le tableau ci-dessous liste les différents domaines.
\vspace{\baselineskip}

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{3}{|c|}{Domaine} \\
\hline
\multicolumn{1}{|c|}{Theme} & \multicolumn{2}{|c|}{Domaine} \\
\hline
Thème & Identifiant & Domaine\\
\hline
}
\tablehead{
\hline
\multicolumn{3}{|c|}{Domaine} \\
\hline
\multicolumn{1}{|c|}{Theme} & \multicolumn{2}{|c|}{Domaine} \\
\hline
Thème & Identifiant & Domaine\\
\hline
}

\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|p{10cm}|c|p{10cm}|}

\begin{lbdpython}

# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
# -- pour chaque theme, calcul du nombre de domaines
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine
#WHERE theme.theme_id = domaine.theme_id 
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;
req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # recherche des domaines correspondant à ce theme_encours_id
   # -- selection domaine
   #SELECT
   #   theme.theme_id as ThemeId,
   #   theme.theme_libelle as ThemeLibelle,
   #   domaine.domaine_id as DomaineId,
   #   domaine.domaine_libelle as DomaineLibelle
   #FROM theme, domaine
   #WHERE theme.theme_id = domaine.theme_id
   #  AND theme.theme_id = theme_encours_id
   #ORDER by theme.theme_id, domaine.domaine_id;
   req_domaine_select = select([th.c.theme_id, th.c.theme_libelle, dom.c.domaine_id, dom.c.domaine_libelle],
                        and_(dom.c.theme_id == theme_encours_id,
                             th.c.theme_id == dom.c.theme_id),
                        order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_select.execute()
   for row_niveau_02 in result_niveau_02:
      if debut_niveau_01 == 1:
         chaine_cline = r"\cline{1-3}"
         if row_niveau_01.count == 1:
           chaine_colonne_01 = r"%s" %(row_niveau_02.theme_libelle)
         else:
           chaine_colonne_01 = r"\multirow{%s}{10cm}{%s}" %(row_niveau_01.count, row_niveau_02.theme_libelle)
      else:
         chaine_cline = r"\cline{2-3}"
         chaine_colonne_01 = r"                  "
      debut_niveau_01 = 0
      chaine_colonne_02 = r"%s" %(row_niveau_02.domaine_id)
      chaine_colonne_03 = r"%s" %(row_niveau_02.domaine_libelle)
      but.write(chaine_cline + "" + chaine_colonne_01 + " & " + chaine_colonne_02 + " & " + chaine_colonne_03 + r"\\" + "\n")

# on n'oublie pas de refermer le tableau
but.write(r"\hline")

\end{lbdpython}
\end{supertabular}

% Les classes
% ^^^^^^^^^^^^
\section{Les Classes}
Le tableau ci-dessous liste les différentes classes.
\vspace{\baselineskip}

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{4}{|c|}{Classe} \\
\hline
\multicolumn{2}{|c|}{Theme / Domaine} &  \multicolumn{2}{|c|}{Classe} \\
\hline
Thème & Domaine & Identifiant & Classe\\
\hline
}
\tablehead{
\hline
\multicolumn{4}{|c|}{Classe} \\
\hline
\multicolumn{2}{|c|}{Theme / Domaine} &  \multicolumn{2}{|c|}{Classe} \\
\hline
Thème & Domaine & Identifiant & Classe\\
\hline
}
\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|p{7.5cm}|p{7.5cm}|c|p{10cm}|}

\begin{lbdpython}

# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre de classes
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les classes correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre de classes
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe
   #WHERE theme.theme_id = domaine.theme_id 
   #  AND domaine.domaine_id = classe.domaine_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            dom.c.theme_id == theme_encours_id),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # recherche des classes correspondant à ce domaine_encours_id
      # -- selection classe
      #SELECT
      #   theme.theme_id as ThemeId,
      #   theme.theme_libelle as ThemeLibelle,
      #   domaine.domaine_id as DomaineId,
      #   domaine.domaine_libelle as DomaineLibelle,
      #   classe.classe_id as ClasseId,
      #   classe.classe_libelle as ClasseLibelle
      #FROM theme, domaine, classe
      #WHERE theme.theme_id = domaine.theme_id
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND domaine.domaine_id = domaine_encours_id
      #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
      req_classe_select = select([th.c.theme_id, th.c.theme_libelle,
                                  dom.c.domaine_id, dom.c.domaine_libelle,
                                  cls.c.classe_id, cls.c.classe_libelle],
                           and_(th.c.theme_id == dom.c.theme_id,
                                dom.c.domaine_id == cls.c.domaine_id,                              
                                dom.c.domaine_id == domaine_encours_id),
                           order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_select.execute()
      for row_niveau_03 in result_niveau_03:
         if debut_niveau_01 == 1:
            if row_niveau_01.count == 1:
               chaine_colonne_01 = r"%s" %(row_niveau_03.theme_libelle)
            else:
               chaine_colonne_01 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_01.count, row_niveau_03.theme_libelle)
         else:
            chaine_colonne_01 = r"                  "
         if debut_niveau_02 == 1:
            if row_niveau_02.count == 1:
               chaine_colonne_02 = r"%s" %(row_niveau_03.domaine_libelle)
            else:
               chaine_colonne_02 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_02.count, row_niveau_03.domaine_libelle)
         else:
            chaine_colonne_02 = r"                  "
         if debut_niveau_01 == 1 and debut_niveau_02 == 1:
            chaine_cline = r"\cline{1-4}"
         elif debut_niveau_01 == 0 and debut_niveau_02 == 1:
            chaine_cline = r"\cline{2-4}"
         else:
            chaine_cline = r"\cline{3-4}"
         debut_niveau_01 = 0
         debut_niveau_02 = 0
         chaine_colonne_03 = r"%s" %(row_niveau_03.classe_id)
         chaine_colonne_04 = r"%s" %(row_niveau_03.classe_libelle)
         but.write(chaine_cline + "" + chaine_colonne_01
                   + " & " + chaine_colonne_02
                   + " & " + chaine_colonne_03 
                   + " & " + chaine_colonne_04
                   + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline")

\end{lbdpython}
\end{supertabular}








\chapter{Catalogue des objets topographiques non-pris en charge dans le SIG}

% introdution de chapitre
% ^^^^^^^^^^^^^^^^^^^^^^^
\section{Introduction}
Seuls les objets non présents dans le SIG sont listés dans ce chapitre.


% Les objets topo
% ^^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un tableau}
Le tableau ci-dessous liste les différents objets.
\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\tablehead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|p{7.5cm}|p{7.5cm}|p{7.5cm}|c|p{10cm}|}

\begin{lbdpython}

# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id,
                       obj.c.bool_objet_sig == 0),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id,
                            obj.c.bool_objet_sig == 0),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id,
                              obj.c.bool_objet_sig == 0),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id,
                                   obj.c.bool_objet_sig == 0),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if debut_niveau_01 == 1:
               if row_niveau_01.count == 1:
                  chaine_colonne_01 = r"%s" %(row_niveau_04.theme_libelle)
               else:
                  chaine_colonne_01 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_01.count, row_niveau_04.theme_libelle)
            else:
               chaine_colonne_01 = r"                  "
            if debut_niveau_02 == 1:
               if row_niveau_02.count == 1:
                  chaine_colonne_02 = r"%s" %(row_niveau_04.domaine_libelle)
               else:
                  chaine_colonne_02 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_02.count, row_niveau_04.domaine_libelle)
            else:
               chaine_colonne_02 = r"                  "
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
            else:
               chaine_colonne_03 = r"                  "
            if debut_niveau_01 == 1 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{1-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{2-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 0 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{3-5}"
            else:
               chaine_cline = r"\cline{4-5}"
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + "" + chaine_colonne_01
                      + " & " + chaine_colonne_02
                      + " & " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline")

\end{lbdpython}
\end{supertabular}


% Les objets topo
% ^^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un document structuré - Version sans les attributs et sans la représentation}

\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
\tablehead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
%\begin{supertabular}{|p{10cm}|c|p{15cm}|}

\begin{lbdpython}

# on definit un booleen permettant de distinguer
# la permiere ligne des autres lignes
# c'est la premiere ligne pour un niveau 0
# il faudra ecrire begin{supertabular}
debut_niveau_00 = 1


# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id,
                       obj.c.bool_objet_sig == 0),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id,
                            obj.c.bool_objet_sig == 0),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id,
                              obj.c.bool_objet_sig == 0),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id,
                                   obj.c.bool_objet_sig == 0),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if (debut_niveau_00 == 0) and (debut_niveau_01 == 1 or debut_niveau_02 == 1 or debut_niveau_03 == 1):
               but.write(r"\hline"+"\n")
               chaine = r"\end{supertabular}"
               but.write(chaine+"\n")               
            if debut_niveau_01 == 1:
               chaine = r"\subsection{%s}" %row_niveau_04.theme_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_02 == 1:
               chaine = r"\subsubsection{\large %s}" %row_niveau_04.domaine_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{10cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
               chaine = r"\paragraph{%s}" %row_niveau_04.classe_libelle
               but.write(chaine+"\n")
               chaine = r"\noindent"
               but.write(chaine + "\n")
               chaine = r"\vspace{\baselineskip}"
               but.write(chaine + "\n" + "\n")
               chaine = r"\renewcommand{\arraystretch}{1.2}"
               but.write(chaine + "\n")
               chaine = r"\begin{supertabular}{|p{10cm}|c|p{15cm}|}"
               but.write(chaine+"\n")
            else:
               chaine_colonne_03 = r"                  "
            chaine_cline = r"\cline{2-3}"
            debut_niveau_00 = 0
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + " " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline"+"\n")
chaine = r"\end{supertabular}"
but.write(chaine+"\n")
\end{lbdpython}






% Les objets topo
% ^^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un document structuré - Version avec les attributs et avec la représentation}

\vspace{\baselineskip}



% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet & Infos\\
\hline
}
\tablehead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet & Infos\\
\hline
}
%\begin{supertabular}{|p{10cm}|c|p{15cm}|p{10cm}}



\begin{lbdpython}

# on definit un booleen permettant de distinguer
# la permiere ligne des autres lignes
# c'est la premiere ligne pour un niveau 0
# il faudra ecrire begin{supertabular}
debut_niveau_00 = 1


# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id,
                       obj.c.bool_objet_sig == 0),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id,
                            obj.c.bool_objet_sig == 0),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id,
                              obj.c.bool_objet_sig == 0),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id,
                                   obj.c.bool_objet_sig == 0),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if (debut_niveau_00 == 0) and (debut_niveau_01 == 1 or debut_niveau_02 == 1 or debut_niveau_03 == 1):
               but.write(r"\hline"+"\n")
               chaine = r"\end{supertabular}"
               but.write(chaine+"\n")
               # selection dans la table rep_chagneau des representations pour lles objets de la classe precedente
               cha_select = select([cha.c.code, cha.c.basename, cha.c.fullname],
                               and_(cha.c.code == obj.c.objet_id,
                                    cls.c.classe_id == obj.c.classe_id,
                                    cls.c.classe_id == classe_precedente_id),
                               group_by=[cha.c.code, cha.c.basename, cha.c.fullname],
                               order_by=[cha.c.code])
               result_cha_select = cha_select.execute()
               but.write(r"\begin{figure}[h!]"+"\n")
               but.write(r"  \hfill         % permet de caler à droite de la page"+"\n")
               for row_niveau_05 in result_cha_select:
                  but.write(r"  \begin{minipage}[t]{3cm}"+"\n")
                  but.write(r"    \begin{center}"+"\n")
                  chaine = row_niveau_05.fullname
                  but.write(r"      \includegraphics[height=1.3cm,width=3cm,clip=false,keepaspectratio=true]{" + chaine + "}"+"\n")
                  description_longue = row_niveau_05.basename
                  description_courte = row_niveau_05.code
                  but.write(r"      \caption[~" + description_courte + "]" 
                            + r"{\small{" + description_courte + r"~:} \tiny{" + description_longue + "}}"
                            + r"\label{" + description_longue + "}" + "\n")
                  but.write(r"    \end{center}"+"\n")
                  but.write(r"  \end{minipage}"+"\n")
               but.write(r"\end{figure}"+"\n") 

            if debut_niveau_01 == 1:
               chaine = r"\subsection{%s}" %row_niveau_04.theme_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_02 == 1:
               chaine = r"\subsubsection{\large %s}" %row_niveau_04.domaine_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{10cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
               chaine = r"\paragraph{%s}" %row_niveau_04.classe_libelle
               but.write(chaine+"\n")
               chaine = r"\noindent"
               but.write(chaine + "\n")
               chaine = r"\vspace{\baselineskip}"
               but.write(chaine + "\n" + "\n")
               chaine = r"\renewcommand{\arraystretch}{1.2}"
               but.write(chaine + "\n")
               chaine = r"\begin{supertabular}{|p{10cm}|c|p{13cm}|p{12cm}|}"
               but.write(chaine+"\n")
               classe_encours_id = row_niveau_03.classe_id
               classe_precedente_id = row_niveau_03.classe_id
            else:
               chaine_colonne_03 = r"                  "
            chaine_cline = r"\cline{2-4}"
            objet_encours_id = row_niveau_04.objet_id
            debut_niveau_00 = 0
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            chaine_colonne_06 = r"Liste des attributs :" + "\n"
            chaine_colonne_06 += r"\begin{enumerate}" + "\n"
            # selection dans la table objet_attribut_topo des attributs pour les objets de la classe precedente
            att_select = select([att.c.code_objet, att.c.code_attribut, att.c.rang_attribut, att.c.libelle_attribut],
                         and_(att.c.code_objet == objet_encours_id),
                         group_by=[att.c.code_objet, att.c.code_attribut, att.c.rang_attribut, att.c.libelle_attribut],
                         order_by=[att.c.rang_attribut])
            result_att_select = att_select.execute()
            for row_niveau_06 in result_att_select:  
                chaine_colonne_06 +=  r"  \item %s" %row_niveau_06.libelle_attribut
            chaine_colonne_06 += r"\end{enumerate}"+"\n"

            but.write(chaine_cline + " " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + " & " + chaine_colonne_06
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline"+"\n")
chaine = r"\end{supertabular}"
but.write(chaine+"\n")
# pour le dernier element de la liste, ne pas oublier de faire les figures....
# selection dans la table rep_chagneau des representations pour les objets de la classe precedente
cha_select = select([cha.c.code, cha.c.basename, cha.c.fullname],
             and_(cha.c.code == obj.c.objet_id,
                  cls.c.classe_id == obj.c.classe_id,
                  cls.c.classe_id == classe_precedente_id),
             group_by=[cha.c.code, cha.c.basename, cha.c.fullname],
             order_by=[cha.c.code])
result_cha_select = cha_select.execute()
but.write(r"\begin{figure}[h!]"+"\n")
but.write(r"  \hfill         % permet de caler à droite de la page"+"\n")
for row_niveau_05 in result_cha_select:
   but.write(r"  \begin{minipage}[t]{3cm}"+"\n")
   but.write(r"    \begin{center}"+"\n")
   chaine = row_niveau_05.fullname
   but.write(r"      \includegraphics[height=1.3cm,width=3cm,clip=false,keepaspectratio=true]{" + chaine + "}"+"\n")
   description_longue = row_niveau_05.basename
   description_courte = row_niveau_05.code
   but.write(r"      \caption[~" + description_courte + "]" 
             + r"{\small{" + description_courte + r"~:} \tiny{" + description_longue + "}}"
             + r"\label{" + description_longue + "}" + "\n")
   but.write(r"    \end{center}"+"\n")
   but.write(r"  \end{minipage}"+"\n")
but.write(r"\end{figure}"+"\n") 

\end{lbdpython}







\chapter{Catalogue des objets SIG}

% introdution de chapitre
% ^^^^^^^^^^^^^^^^^^^^^^^
\section{Introduction}
Seuls les objets déjà présents dans le SIG sont listés dans ce chapitre.


% Les objets SIG
% ^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un tableau}
Le tableau ci-dessous liste les différents objets.
\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\tablehead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|p{7.5cm}|p{7.5cm}|p{7.5cm}|c|p{10cm}|}

\begin{lbdpython}

# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id,
                       obj.c.bool_objet_sig == 1),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id,
                            obj.c.bool_objet_sig == 1),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id,
                              obj.c.bool_objet_sig == 1),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id,
                                   obj.c.bool_objet_sig == 1),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if debut_niveau_01 == 1:
               if row_niveau_01.count == 1:
                  chaine_colonne_01 = r"%s" %(row_niveau_04.theme_libelle)
               else:
                  chaine_colonne_01 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_01.count, row_niveau_04.theme_libelle)
            else:
               chaine_colonne_01 = r"                  "
            if debut_niveau_02 == 1:
               if row_niveau_02.count == 1:
                  chaine_colonne_02 = r"%s" %(row_niveau_04.domaine_libelle)
               else:
                  chaine_colonne_02 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_02.count, row_niveau_04.domaine_libelle)
            else:
               chaine_colonne_02 = r"                  "
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
            else:
               chaine_colonne_03 = r"                  "
            if debut_niveau_01 == 1 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{1-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{2-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 0 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{3-5}"
            else:
               chaine_cline = r"\cline{4-5}"
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + "" + chaine_colonne_01
                      + " & " + chaine_colonne_02
                      + " & " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline")

\end{lbdpython}
\end{supertabular}


% Les objets SIG
% ^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un document structuré}

\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
\tablehead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
%\begin{supertabular}{|p{10cm}|c|p{15cm}|}

\begin{lbdpython}

# on definit un booleen permettant de distinguer
# la permiere ligne des autres lignes
# c'est la premiere ligne pour un niveau 0
# il faudra ecrire begin{supertabular}
debut_niveau_00 = 1


# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id,
                       obj.c.bool_objet_sig == 1),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id,
                            obj.c.bool_objet_sig == 1),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id,
                              obj.c.bool_objet_sig == 1),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id,
                                   obj.c.bool_objet_sig == 1),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if (debut_niveau_00 == 0) and (debut_niveau_01 == 1 or debut_niveau_02 == 1 or debut_niveau_03 == 1):
               but.write(r"\hline"+"\n")
               chaine = r"\end{supertabular}"
               but.write(chaine+"\n")               
            if debut_niveau_01 == 1:
               chaine = r"\subsection{%s}" %row_niveau_04.theme_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_02 == 1:
               chaine = r"\subsubsection{\large %s}" %row_niveau_04.domaine_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{10cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
               chaine = r"\paragraph{%s}" %row_niveau_04.classe_libelle
               but.write(chaine+"\n")
               chaine = r"\noindent"
               but.write(chaine + "\n")
               chaine = r"\vspace{\baselineskip}"
               but.write(chaine + "\n" + "\n")
               chaine = r"\renewcommand{\arraystretch}{1.2}"
               but.write(chaine + "\n")
               chaine = r"\begin{supertabular}{|p{10cm}|c|p{15cm}|}"
               but.write(chaine+"\n")
            else:
               chaine_colonne_03 = r"                  "
            chaine_cline = r"\cline{2-3}"
            debut_niveau_00 = 0
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + " " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline"+"\n")
chaine = r"\end{supertabular}"
but.write(chaine+"\n")
\end{lbdpython}





\chapter{Catalogue de l'ensemble des objets}


% introdution de chapitre
% ^^^^^^^^^^^^^^^^^^^^^^^
\section{Introduction}
Dans ce chapitre, tous les objets topographiques sont listés.


% Les objets - tous
% ^^^^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un tableau}
Le tableau ci-dessous liste les différents objets.
\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\tablehead{
\hline
\multicolumn{5}{|c|}{Objet} \\
\hline
\multicolumn{3}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Thème & Domaine & Classe & Identifiant & Objet \\
\hline
}
\renewcommand{\arraystretch}{1.2}
\begin{supertabular}{|p{7.5cm}|p{7.5cm}|p{7.5cm}|c|p{10cm}|}

\begin{lbdpython}

# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if debut_niveau_01 == 1:
               if row_niveau_01.count == 1:
                  chaine_colonne_01 = r"%s" %(row_niveau_04.theme_libelle)
               else:
                  chaine_colonne_01 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_01.count, row_niveau_04.theme_libelle)
            else:
               chaine_colonne_01 = r"                  "
            if debut_niveau_02 == 1:
               if row_niveau_02.count == 1:
                  chaine_colonne_02 = r"%s" %(row_niveau_04.domaine_libelle)
               else:
                  chaine_colonne_02 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_02.count, row_niveau_04.domaine_libelle)
            else:
               chaine_colonne_02 = r"                  "
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{7.5cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
            else:
               chaine_colonne_03 = r"                  "
            if debut_niveau_01 == 1 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{1-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 1 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{2-5}"
            elif debut_niveau_01 == 0 and debut_niveau_02 == 0 and debut_niveau_03 == 1:
               chaine_cline = r"\cline{3-5}"
            else:
               chaine_cline = r"\cline{4-5}"
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + "" + chaine_colonne_01
                      + " & " + chaine_colonne_02
                      + " & " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline")

\end{lbdpython}
\end{supertabular}



% Les objets - tous
% ^^^^^^^^^^^^^^^^^
\section{Les Objets - Présentation sous la forme d'un document structuré}


\vspace{\baselineskip}
% Requete req_objet
%\texdbdef{##req_objet}{
%SELECT
%   theme.theme_id as ThemeId,
%   theme.theme_libelle as ThemeLibelle,
%   domaine.domaine_id as DomaineId,
%   domaine.domaine_libelle as DomaineLibelle,
%   classe.classe_id as ClasseId,
%   classe.classe_libelle as ClasseLibelle,
%   objet.objet_id as ObjetId,
%   objet.objet_libelle as ObjetLibelle
%FROM theme, domaine, classe, objet
%WHERE theme.theme_id = domaine.theme_id
%  AND domaine.domaine_id = classe.domaine_id
%  AND classe.classe_id = objet.classe_id
%ORDER by theme.theme_id, domaine.domaine_id, classe.classe_id, objet.objet_id; }

% les options de supertabular sont a definir
% avant \begin{supertabular}
\tablefirsthead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
\tablehead{
%\hline
%\multicolumn{3}{|c|}{Objet} \\
%\hline
%\multicolumn{1}{|c|}{Theme / Domaine / Classe} & \multicolumn{2}{|c|}{Objet} \\
\hline
Classe & Identifiant & Objet \\
\hline
}
%\begin{supertabular}{|m{10cm}|c|m{15cm}|}

\begin{lbdpython}

# on definit un booleen permettant de distinguer
# la permiere ligne des autres lignes
# c'est la premiere ligne pour un niveau 0
# il faudra ecrire begin{supertabular}
debut_niveau_00 = 1


# on definit une requete de comptage
# cette requete est utilisée pour la mise en forme du tableau
#-- pour chaque theme, calcul du nombre d'objets
#SELECT
#   theme.theme_id as ThemeId,
#   count(1)
#FROM theme, domaine, classe, objet
#WHERE theme.theme_id = domaine.theme_id 
#  AND domaine.domaine_id = classe.domaine_id
#  AND classe.classe_id = objet.classe_id
#GROUP BY theme.theme_id
#ORDER BY theme.theme_id;

req_theme_count = select([th.c.theme_id, func.count(1)],
                  and_(th.c.theme_id == dom.c.theme_id,
                       dom.c.domaine_id == cls.c.domaine_id,
                       cls.c.classe_id == obj.c.classe_id),
                  group_by=[th.c.theme_id],
                  order_by=[th.c.theme_id])
result_niveau_01 = req_theme_count.execute()
for row_niveau_01 in result_niveau_01:
   # on definit un booleen permettant de distinguer dans le tableau
   # la permiere ligne des autres lignes
   # c'est la premiere ligne pour un niveau 1
   debut_niveau_01 = 1
   theme_encours_id = row_niveau_01.theme_id
   # on liste les domaines et on compte les objets correspondant à ce theme_encours_id
   #-- pour chaque domaine, calcul du nombre d'objets
   #SELECT
   #   theme.theme_id as ThemeId,
   #   domaine.domaine_id as DomaineId,
   #   count(1)
   #FROM theme, domaine, classe, objet
   #WHERE theme.theme_id = domaine.theme_id
   #  AND domaine.domaine_id = classe.domaine_id
   #  AND classe.classe_id = objet.classe_id
   #GROUP BY theme.theme_id, domaine.domaine_id
   #ORDER BY theme.theme_id, domaine.domaine_id;
   req_domaine_count = select([th.c.theme_id, dom.c.domaine_id, func.count(1)],
                       and_(th.c.theme_id == dom.c.theme_id,
                            dom.c.domaine_id == cls.c.domaine_id,
                            cls.c.classe_id == obj.c.classe_id,
                            th.c.theme_id == theme_encours_id),
                       group_by=[th.c.theme_id, dom.c.domaine_id],
                       order_by=[th.c.theme_id, dom.c.domaine_id])
   result_niveau_02 = req_domaine_count.execute()
   for row_niveau_02 in result_niveau_02:
      # on definit un booleen permettant de distinguer dans le tableau
      # la permiere ligne des autres lignes
      # c'est la premiere ligne pour un niveau 2
      debut_niveau_02 = 1
      domaine_encours_id = row_niveau_02.domaine_id
      # on liste les classes et on compte les objets correspondant à ce domaine_encours_id
      #-- pour chaque classe, calcul du nombre d'objets
      #SELECT
      #   theme.theme_id as ThemeId,
      #   domaine.domaine_id as DomaineId,
      #   classe.classe_id as Classe_id,
      #   count(1)
      #FROM theme, domaine, classe, objet
      #WHERE theme.theme_id = domaine.theme_id 
      #  AND domaine.domaine_id = classe.domaine_id
      #  AND classe.classe_id = objet.classe_id
      #GROUP BY theme.theme_id, domaine.domaine_id, classe.classe_id
      #ORDER BY theme.theme_id, domaine.domaine_id, classe.classe_id;
      req_classe_count = select([th.c.theme_id, dom.c.domaine_id,
                                 cls.c.classe_id, func.count(1)],
                         and_(th.c.theme_id == dom.c.theme_id,
                              dom.c.domaine_id == cls.c.domaine_id,
                              cls.c.classe_id == obj.c.classe_id,
                              dom.c.domaine_id == domaine_encours_id),
                         group_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id],
                         order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id])
      result_niveau_03 = req_classe_count.execute()
      for row_niveau_03 in result_niveau_03:
         # on definit un booleen permettant de distinguer dans le tableau
         # la permiere ligne des autres lignes
         # c'est la premiere ligne pour un niveau 3
         debut_niveau_03 = 1
         classe_encours_id = row_niveau_03.classe_id
         # recherche des classes correspondant à ce domaine_encours_id
         # -- selection objet
         #SELECT
         #   theme.theme_id as ThemeId,
         #   theme.theme_libelle as ThemeLibelle,
         #   domaine.domaine_id as DomaineId,
         #   domaine.domaine_libelle as DomaineLibelle,
         #   classe.classe_id as ClasseId,
         #   classe.classe_libelle as ClasseLibelle,
         #   objet.objet_id as ObjetId,
         #   objet.objet_libelle as ObjetLibelle
         #FROM theme, domaine, classe, objet
         #WHERE theme.theme_id = domaine.theme_id
         #  AND domaine.domaine_id = classe.domaine_id
         #  AND domaine.domaine_id = domaine_encours_id
         #ORDER by theme.theme_id, domaine.domaine_id, classe_id;
         req_objet_select = select([th.c.theme_id, th.c.theme_libelle,
                                    dom.c.domaine_id, dom.c.domaine_libelle,
                                    cls.c.classe_id, cls.c.classe_libelle,
                                    obj.c.objet_id, obj.c.objet_libelle],
                              and_(th.c.theme_id == dom.c.theme_id,
                                   dom.c.domaine_id == cls.c.domaine_id,                              
                                   cls.c.classe_id == obj.c.classe_id,                              
                                   cls.c.classe_id == classe_encours_id),
                              order_by=[th.c.theme_id, dom.c.domaine_id, cls.c.classe_id, obj.c.objet_id])
         result_niveau_04 = req_objet_select.execute()
         for row_niveau_04 in result_niveau_04:
            if (debut_niveau_00 == 0) and (debut_niveau_01 == 1 or debut_niveau_02 == 1 or debut_niveau_03 == 1):
               but.write(r"\hline"+"\n")
               chaine = r"\end{supertabular}"
               but.write(chaine+"\n")               
            if debut_niveau_01 == 1:
               chaine = r"\subsection{%s}" %row_niveau_04.theme_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_02 == 1:
               chaine = r"\subsubsection{\large %s}" %row_niveau_04.domaine_libelle
               but.write(chaine+"\n")
            else:
               but.write(""+"\n")
            if debut_niveau_03 == 1:
               if row_niveau_03.count == 1:
                  chaine_colonne_03 = r"%s" %(row_niveau_04.classe_libelle)
               else:
                  chaine_colonne_03 = r"\multirow{%s}{10cm}{%s}" %(row_niveau_03.count, row_niveau_04.classe_libelle)
               chaine = r"\paragraph{%s}" %row_niveau_04.classe_libelle
               but.write(chaine+"\n")
               chaine = r"\noindent"
               but.write(chaine + "\n")
               chaine = r"\vspace{\baselineskip}"
               but.write(chaine + "\n" + "\n")
               chaine = r"\renewcommand{\arraystretch}{1.2}"
               but.write(chaine + "\n")
               chaine = r"\begin{supertabular}{|p{10cm}|c|p{15cm}|}"
               but.write(chaine+"\n")
            else:
               chaine_colonne_03 = r"                  "
            chaine_cline = r"\cline{2-3}"
            debut_niveau_00 = 0
            debut_niveau_01 = 0
            debut_niveau_02 = 0
            debut_niveau_03 = 0
            chaine_colonne_04 = r"%s" %(row_niveau_04.objet_id)
            chaine_colonne_05 = r"%s" %(row_niveau_04.objet_libelle)
            but.write(chaine_cline + " " + chaine_colonne_03 
                      + " & " + chaine_colonne_04
                      + " & " + chaine_colonne_05
                      + r"\\" + "\n")
# on n'oublie pas de refermer le tableau
but.write(r"\hline"+"\n")
chaine = r"\end{supertabular}"
but.write(chaine+"\n")
\end{lbdpython}

\backmatter

\chapter{Conclusion}
Texte Conclusion

%\tableofcontents

\end{document}